# Chat 功能重构说明

## 架构概述

重构后的Chat功能采用类似ChatGPT的三部分布局：

```
┌─────────────────────────────────────────┐
│                Header                   │
├──────────┬──────────────────────────────┤
│          │                              │
│  Sidebar │            Body              │
│          │                              │
│          ├──────────────────────────────┤
│          │           Input              │
└──────────┴──────────────────────────────┘
```

## 文件结构

```
src/app/chat/
├── layout.tsx          # 主布局文件，整合所有组件
├── page.tsx           # 聊天页面
├── plan.md            # 功能规划文档
└── README.md          # 说明文档

src/components/features/chat/
├── ChatSidebar.tsx    # 左侧会话列表
├── ChatHeader.tsx     # 顶部标题栏
├── ChatBody.tsx       # 消息显示区域
├── ChatInput.tsx      # 底部输入框
├── MessageBubble.tsx  # 消息气泡组件
├── CustomBubble.tsx   # 自定义消息气泡
├── Attachments.tsx    # 附件组件
├── PlaceholderTag.tsx # 占位符标签
└── index.ts          # 统一导出
```

## 组件职责

### ChatSidebar (左侧边栏)
- 显示会话列表
- 支持创建、删除、重命名会话
- 会话搜索功能
- 会话类型标识

### ChatHeader (顶部标题栏)
- 显示当前会话信息
- 模型配置显示
- 会话操作菜单（设置、分享、导出、清空）

### ChatBody (消息区域)
- 消息列表展示
- 空状态提示
- 加载状态显示
- 流式输出支持

### ChatInput (输入区域)
- 文本输入
- 图片/文件上传
- 占位符插入
- 发送/取消控制

### MessageBubble (消息气泡)
- 用户/AI消息展示
- 多模态内容支持
- 消息操作（复制、重试、编辑、删除）
- 消息状态显示

## 数据流

1. **状态管理**: 使用 `useChatStore` (Zustand) 统一管理所有聊天状态
2. **组件通信**: 通过 props 传递事件处理函数
3. **API调用**: 通过 `chatApi` 服务处理与后端的通信

## 主要功能

✅ **已实现功能**:
- 会话管理（创建、删除、切换、重命名）
- 消息发送与接收
- 流式响应显示
- 多模态支持（文本+图片）
- 系统提示词配置
- 模型参数配置
- 消息重试/编辑/删除
- 占位符功能

🚧 **待完善功能**:
- 设置面板
- 会话分享/导出
- 更多模型支持
- 插件系统

## 使用方式

访问 `/chat` 路径即可使用重构后的聊天界面。所有功能都通过 `chatStore` 进行状态管理，UI组件只负责展示和用户交互。