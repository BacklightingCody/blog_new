# ChatUI 功能清单（功能说明 + 实现责任划分）

本文件列出了 ChatUI 项目中支持的全部功能，涵盖消息交互、模型配置、会话管理、上下文增强等模块，并对每一项功能划分前端/后端实现职责，便于团队协作与开发排期。

---

## 📦 核心功能模块

### 1. 消息发送与接收

- ✅ 支持用户发送消息给 AI，包括文本、图片
- ✅ 支持 AI 回复消息，并展示在消息流中
- ✅ 支持消息状态：发送中 / 成功 / 错误 / 取消

| 责任 | 实现说明 |
|------|----------|
| 前端 | 构建 ChatInput、ChatMessageList，维护 `ChatMessage.status`，上传图片、处理用户输入等 |
| 后端 | 接收消息请求（`SendMessageRequest`），调用大模型生成响应，返回消息内容与状态 |

---

### 2. 流式响应渲染（Streaming）

- ✅ 支持 AI token 逐字输出（如 OpenAI stream）
- ✅ 支持错误中断和重试逻辑

| 责任 | 实现说明 |
|------|----------|
| 前端 | 处理 EventSource / WebSocket，动态更新消息内容；使用 `metadata.loadingId` 跟踪流式 token |
| 后端 | 支持 `stream: true` 的接口协议，实时返回增量内容（兼容 SSE）

---

### 3. 多模态支持（图文混合）

- ✅ 用户可以上传图片并发送
- ✅ AI 回复中可以包含 image_url 内容（如图示说明）

| 责任 | 实现说明 |
|------|----------|
| 前端 | 支持图片预览组件，渲染 `MessageContent` 中的 `image_url` |
| 后端 | 接收用户图片上传请求，返回 URL；处理 `MessageContent[]` 格式的回复内容结构

---

## ⚙️ 模型与 Prompt 配置

### 4. 系统提示词（systemPrompt）

- ✅ 每个会话可设置一个 systemPrompt
- ✅ 支持用户选择已有的提示词模板

| 责任 | 实现说明 |
|------|----------|
| 前端 | 在会话顶部设置区，展示 systemPrompt 选择框，并提交给 API |
| 后端 | 存储 systemPrompt 内容，拼接为大模型请求的第一条消息（role: system）

---

### 5. 模型参数配置

- ✅ 支持配置模型名称、temperature、topK、topP、maxTokens 等

| 责任 | 实现说明 |
|------|----------|
| 前端 | 在设置面板中展示配置选项并允许修改，提交 `modelConfig` |
| 后端 | 将模型配置参数用于构造调用大模型的 API 请求（如 OpenAI API 参数）

---

## 💬 会话管理功能

### 6. 会话列表与切换

- ✅ 支持创建、删除、切换多个会话
- ✅ 每个会话包含唯一 ID 和消息历史

| 责任 | 实现说明 |
|------|----------|
| 前端 | 构建会话侧边栏组件，支持切换与会话状态保存 |
| 后端 | 提供 CRUD 接口：创建会话、删除会话、获取所有会话列表

---

### 7. 会话重命名 / 固定 / 归档 / 标签

- ✅ 支持重命名会话名称
- ✅ 支持会话置顶、归档操作
- ✅ 支持对会话打自定义标签（如 blog、测试等）

| 责任 | 实现说明 |
|------|----------|
| 前端 | 提供重命名输入框、归档/固定操作按钮；本地或远程排序处理 |
| 后端 | 存储 `ChatSession.name`、`pinned`、`isArchived`、`tags` 等字段，提供更新接口

---

## 🧩 占位符功能（上下文注入）

### 8. 插入占位符（Placeholder）

- ✅ 支持用户插入占位符如 `@{{doc}}`、`@{{language}}`
- ✅ 占位符类型包括：doc、img、product、version、language 等
- ✅ 占位符可以从博客文章中选中生成（例如文档片段）

| 责任 | 实现说明 |
|------|----------|
| 前端 | 提供占位符插入工具栏 / 弹窗；支持选中文本生成占位符；管理 `PlaceholderItem[]` |
| 后端 | 占位符用于构造 prompt 前进行替换（`applyPlaceholders()`），拼成最终提交的大模型请求

---

### 9. 动态内容替换与提示构造

- ✅ 提交消息前将内容中的 `@{{key}}` 替换为对应值
- ✅ 支持在 UI 中查看原始输入和最终替换后的内容

| 责任 | 实现说明 |
|------|----------|
| 前端 | 使用 `applyPlaceholders(content, placeholders)` 替换逻辑 |
| 后端 | 可选支持服务端拼装 prompt（如 OpenAI message array），或日志记录 rawContent 与替换后内容

---

## 🧾 附加支持功能

### 10. 消息重试 / 错误反馈

- ✅ 失败消息可点击重发
- ✅ 显示错误信息（如超时、token 限制等）

| 责任 | 实现说明 |
|------|----------|
| 前端 | 显示 `ChatMessage.status === 'error'` 状态；重试时重新调用发送逻辑 |
| 后端 | 在失败时返回 `error` 字段，并保持 messageId 一致供前端重试

---

### 11. Markdown 内容渲染

- ✅ AI 回复中支持 Markdown 格式
- ✅ 支持代码块、链接、图片展示等

| 责任 | 实现说明 |
|------|----------|
| 前端 | 使用 `ReactMarkdown` + 自定义组件渲染所有 markdown 内容，优化样式 |
| 后端 | 返回文本格式即可，由前端渲染 markdown

---

## 📌 附录：接口数据参考（简要）

- `ChatMessage`：消息结构，支持图片、文本、错误状态
- `ChatSession`：会话结构，支持 pinned、tags、systemPrompt
- `SendMessageRequest`：发送消息结构，支持 `content + placeholders`
- `PlaceholderItem`：占位符结构，支持 `key/value/type/label`
- `ModelConfig`：大模型调用配置参数

---

如需更详细的数据字段定义，请参阅项目中的 `types.ts` 文件。
